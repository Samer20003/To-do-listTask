<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-do</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="index.css">
    <!-- <link rel="stylesheet" href="index.css"> -->
        <!-- 1. You have a todo list
        2. Each item contains title, description, date to do it
        3. You need to display this list each item in a row
        4. In each row display the title, description and formatted date (dd-mm)
        5. Each row should contain 3 actions (sort, edit, delete)
        6. Delete action opens a confirmation alert
        7. Edit action makes the todo's title and description and date editable
        8. Group the todos by day
        9. Sorting should happen in the same group -->
</head>
<body class="bg-success p-2" style="--bs-bg-opacity: .5;">
    <div class="d-flex justify-content-center align-items-center  ">
        <div class="to-do" style="width: 400px;">
            <h1 class="text-dark d-flex justify-content-center">To-Do List</h1>
            <ul class="list-group" id="list"></ul>
        
        </div>
    </div>
    <script src="jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script>

        // 1. define an array of object that have the title and description and data as a keys and there values 
        // 2. define a function that convert the date ass (dd-mm)
        // 3. define a function that render the data inside our array by using forEach and make a form inside it to append it for the todoIem in html 
        // 4- in Delete button i make a modal to pop it when the user click delete to confirm the deletion of the li 
        // 5- in Edit button when the user click edit it change the attribute to inputs so the user can add what he need 
        //     * also on edit button there is two buttons save and cancel the save button take the new value that the user insert it and put it insted of the old one
        //     * the cancel button will close the modal that shown and return the user in the li every button work alone to the specifc li 
        // 6- in Sort button when the user click sort it can drag it while he still click the button and go with li forword or backword 

        (function(){

            const todos = [
                { title: 'Reading', description: 'Read a new book ', date: '2015-04-02' },
                { title: 'Study', description: 'Study for 4 hours per day', date: '2015-04-02' },
                { title: 'Workout', description: 'Chest day workout for 2 hours', date: '2015-04-02' },
            ];
    
            function formatDate(dateString) {
                const date = new Date(dateString);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                return `${day} - ${month}`;
            }
    
            function renderTodos() {
                $('#list').empty();
                todos.forEach((todo, index) => {
                    const item = $(`
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between">
                                <div class="content">
                                    <h5 class="title" data-index="${index}">${todo.title}</h5>
                                    <p class="parg">${todo.description}</p>
                                    <p class="date">${formatDate(todo.date)}</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end gap-2 buttons">
                                <button class="btn btn-secondary btn-sm sort-btn">Sort</button>
                                <button class="btn btn-secondary btn-sm edit-btn btn2" data-index="${index}">Edit</button>
                                <button class="btn btn-danger btn-sm delete-btn btn3 " data-bs-toggle="modal"  data-index="${index}">Delete</button>
                            </div>
                        </li>
                    `);
                    $('#list').append(item);
                });
            }
    
            let draggedItem = null;
            let placeholder = $('<li class="placeholder"></li>');
    
            // Delete button
            $('#list').on('click', '.delete-btn', function() {
                const index = $(this).data('index');
                const todo = todos[index];
                $('#deleteModal').remove(); // remove the delete modal if it exists so we dynamically show the title each time on every list 
                const newModale= (`
                <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                           <h5 class="modal-title" id="deleteModalLabel">Warning!</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this "${todo.title}"?</p>
                     </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="confirmDelete">Delete</button>
                    </div>
                </div>
            </div>
        </div>
      `)
                   $('body').append(newModale);
                   var myModal= new bootstrap.Modal(document.getElementById('deleteModal'));
                   myModal.show(); 
                   $('#confirmDelete').on('click',function(){
                    todos.splice(index, 1);
                    $('#deleteModal').modal('hide');
                    $('#deleteModal').remove();
                    renderTodos();
                   })
            });
            // Edit button
            $('#list').on('click', '.edit-btn', function() {
                const index = $(this).data('index');
                const todo = todos[index];
                $(this).siblings('.sort-btn, .btn2,.btn3').addClass('disapper');
                $(this).addClass('disapper');
               // create a new form to replace it when the edit button is clicked
                const editForm = $(`
                    <div class="edit-form">
                        <input type="text" class="form-control mb-2" id="edit-title" value="${todo.title}">
                        <input type="text" class="form-control mb-2" id="edit-description" value="${todo.description}">
                        <input type="date" class="form-control mb-2" id="edit-date" value="${todo.date}">
                        <button class="btn btn-primary btn-sm save-btn" data-index="${index}">Save</button>
                        <button class="btn btn-secondary btn-sm cancel-btn" data-index="${index}">Cancel</button>
                    </div>
                `);
                $(this).closest('.list-group-item').find('.content').replaceWith(editForm);
            });
            // Cancel button
            $('#list').on('click', '.cancel-btn', function() {
                const index = $(this).data('index');
                const todo = todos[index];
                $('#list').find('.sort-btn,.btn2,.btn3').removeClass('disapper');
                const originalForm = $(`
                    <div class="content">
                        <h5 class="title" data-index="${index}">${todo.title}</h5>
                        <p class="parg">${todo.description}</p>
                        <p class="date">${formatDate(todo.date)}</p>
                    </div>
                `);
                $(this).closest('.list-group-item').find('.edit-form').replaceWith(originalForm);
            });
            // Save button
            $('#list').on('click', '.save-btn', function() {
                const index = $(this).data('index');
                const newDate = $('#edit-date').val();
                const newTitle = $('#edit-title').val();
                const newDescription = $('#edit-description').val();
                $('#list').find('.sort-btn,.btn2,.btn3').removeClass('disapper');

                if (newTitle && newDescription && newDate) {
                    todos[index] = {
                        date: newDate, 
                        title: newTitle, // the index on title just why ? 
                        description: newDescription
                    };
                    const newForm = $(`
                        <div class="content">
                            <h5 class="title" data-index="${index}">${newTitle}</h5>  
                            <p class="parg">${newDescription}</p>
                            <p class="date">${formatDate(newDate)}</p>
                        </div>
                    `);
                    $(this).closest('.edit-form').replaceWith(newForm);
                }
            });
            // Sort button
            $('#list').on('mousedown', '.sort-btn', function(e) {
                draggedItem = $(this).closest('li');
                $(document).on('mousemove', onMouseMove); // define a function that will be called when the mouse moves
                $(document).on('mouseup', onMouseUp); // define a function that will be called when the mouse is released
                placeholder.height(draggedItem.outerHeight()); // set placeholder height to the height of the dragged item ourHeight() return the height with the border and padding
                draggedItem.after(placeholder);
                draggedItem.addClass('dragging');
                draggedItem.css({
                    position: 'absolute',
                    zIndex: 1000,
                    width: draggedItem.outerWidth(),
                    top: e.pageY - draggedItem.outerHeight() / 2, //// pageY is a read-only property of the MouseEvent interface returns the Y (vertical) coordinate in pixels
                    left: draggedItem.offset().left
                });
            });
    
            function onMouseMove(e) {
                if (draggedItem) {
                    draggedItem.css({
                        top: e.pageY - draggedItem.outerHeight() / 2 
                    });
                    $('#list').find('li:not(.placeholder)').each(function() {
                        const currentItem = $(this);
                        const offset = currentItem.offset();
                        const midpoint = offset.top + currentItem.outerHeight() / 2;
                        if (e.pageY < midpoint) { 
                            placeholder.insertBefore(currentItem);
                            return false;
                        } else {
                            placeholder.insertAfter(currentItem);
                        }
                    });
                }
            }
            function onMouseUp() {
                if (draggedItem) {
                    placeholder.before(draggedItem);
                    draggedItem.removeClass('dragging');
                    draggedItem.css({
                        position: '',
                        top: '',
                        left: '',
                        zIndex: ''
                    });
                    placeholder.remove();
                    draggedItem = null;
                    $(document).off('mousemove', onMouseMove);
                    $(document).off('mouseup', onMouseUp);
                }
            }
            renderTodos();
        })();
    </script>
    
</body>
</html>


